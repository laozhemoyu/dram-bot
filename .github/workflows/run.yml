name: TrendForce Price Monitor with AI

# è®¾ç½®æ‰§è¡Œæ—¶é—´
on:
  workflow_dispatch:      # æ”¯æŒåœ¨ Actions é¡µé¢æ‰‹åŠ¨ç‚¹å‡»è¿è¡Œ
  schedule:
    - cron: '0 2 * * *'   # æ¯å¤©åŒ—äº¬æ—¶é—´ 10:00 è¿è¡Œ (UTC 2:00)

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.9'

    # ğŸ”¥ ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¸­æ–‡å­—ä½“ (è§£å†³å›¾ç‰‡ä¸­æ–‡ä¹±ç çš„å…³é”®)
    - name: Install Chinese Fonts
      run: |
        sudo apt-get update
        sudo apt-get install -y fonts-wqy-microhei fonts-wqy-zenhei

    # ç¬¬äºŒæ­¥ï¼šå®‰è£… Python ä¾èµ–
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install selenium webdriver-manager requests matplotlib beautifulsoup4 openai

    # ğŸ”¥ ç¬¬ä¸‰æ­¥ï¼šè¿è¡Œè„šæœ¬å¹¶ä¼ é€’æ‰€æœ‰ Secrets (è¿™å°±æ˜¯ä½ é—®çš„ API å†™å…¥ä½ç½®)
    - name: Run Price Monitor Script
      env:
        # é’‰é’‰æ¨é€é…ç½®
        DING_WEBHOOK: ${{ secrets.DING_WEBHOOK }}
        DING_SECRET: ${{ secrets.DING_SECRET }}
        
        # DeepSeek AI é…ç½® (å¿…é¡»åœ¨è¿™é‡Œæ˜¾å¼ä¼ é€’ï¼Œè„šæœ¬é‡Œçš„ os.environ æ‰èƒ½æ‹¿åˆ°)
        AI_API_KEY: ${{ secrets.AI_API_KEY }}
        AI_BASE_URL: ${{ secrets.AI_BASE_URL }}
      run: python main.py
